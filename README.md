# Android example app

Android example to build an app that will access your data on pryv.io using the [Pryv Java library](https://github.com/pryv/lib-java)

This sample app contains the code that provides the login to your pryv account on the platform that you will have defined [here](https://github.com/pryv/app-android-example/blob/master/app/src/main/java/com/pryv/appAndroidExample/LoginActivity.java#L35).
For example, when using the pryv.me demo platform:

```java
public final static String DOMAIN = "pryv.me";
```

After signing in your account the app is able to fetch all Events from a Stream and create a text note on the push of a button.

## Usage

Get the code `git clone https://github.com/pryv/android-app-example`

### Android studio

To use the example app in Android Studio, go to `File>open` and select the folder that was generated by the `git clone`. Now run in on your emulated device or Android phone.

### Eclipse

[Request it](mailto:tech@pryv.com)

## License

[Revised BSD license](https://github.com/pryv/documents/blob/master/license-bsd-revised.md)

## Quick integration with another existing Android app

If you already developed your own Android app and you want to integrate Pryv into it, here is a concise procedure to setup the only elements that you will need and in the shortest time.

### Prerequisites

First of all, you need to include the [Pryv Java library](https://github.com/pryv/lib-java) in your project.

Using **Gradle**, use the following :
```
compile 'com.pryv:android:1.0.0'
```

Using **Maven**, use the following :
```
<dependency>
  <groupId>com.pryv</groupId>
  <artifactId>android</artifactId>
  <version>1.0.0</version>
  <type>pom</type>
</dependency>
```

Using **Ivy**, use the following :
```
<dependency org='com.pryv' name='android' rev='1.0.0'>
  <artifact name='$AID' ext='pom'></artifact>
</dependency>
```

Moreover, do not forget to add the ***Internet permission*** in your ***AndroidManifest.xml*** as follow:

```android
<uses-permission android:name="android.permission.INTERNET" />
```

### Login to your Pryv

You will need to copy the following classes in your project:
[***LoginActivity***](https://github.com/pryv/app-android-example/blob/master/app/src/main/java/com/pryv/appAndroidExample/LoginActivity.java) and
[***Credentials***](https://github.com/pryv/app-android-example/blob/master/app/src/main/java/com/pryv/appAndroidExample/Credentials.java).
Do not forget to declare the ***LoginActivity*** in your manifest and also copy the corresponding xml file.

***LoginActivity*** will handle all the process of account creation and login through a WebView.
As soon as a login is successful, a pair of username and token will be stored in the Android SharedPreferences using a ***Credentials*** object.

You can load the **LoginActivity** on the push of a login button for example and check if the user is log by calling the function ***hasCredentials()*** from your ***Credentials*** object.

Note that you can modify **LoginActivity** to adapt the domain and app ID to be used:

```java
public final static String DOMAIN = "pryv.me";
public final static String APPID = "app-android-example";
```

### Interacting with your Pryv

There is still few necessary additions to be made in your ***MainActivity***.

First of all, you need to initialize the connection by providing the credentials previously stored during the login phase:
```java
Credentials credentials = new Credentials(MainActivity.this);
Connection connection = new Connection(MainActivity.this, credentials.getUsername(), credentials.getToken(), LoginActivity.DOMAIN, true, new DBinitCallback());
```

You can then use the following functions:

***Create a Stream:***
```java
Stream containerStream = new Stream("StreamID", "StreamName");
connection.streams.create(containerStream, streamsCallback);
```

***Create an Event:***
```java
String streamId = "StreamID";
String eventType = "note/txt";
String content = "Some text";
connection.events.create(new Event(streamId, null, eventType, content), eventsCallback);
```

***Get Events:***
```java
Stream containerStream = new Stream("StreamID", "StreamName");
Filter filter = new Filter();
filter.addStream(containerStream);
connection.events.get(filter, getEventsCallback);
```

***Get Streams:***
```java
Stream parentStream = new Stream("StreamID", "StreamName");
Filter filter = new Filter();
filter.addStream(parentStream);
connection.streams.get(filter, getStreamsCallback);
```

### UI notifications

Creating Events is a first step but you surely want to inform the user when this is done.
To do so, you will need to configure your own message ***Handler*** in your ***MainActivity***, which will be used by a ***UINotifier*** to notify the UI.

Here is an example of a simple Handler, which will pop the string content of any received notification:

```java
private final Handler notificationHandler = new Handler() {
        public void handleMessage(Message msg) {
            Bundle b = msg.getData();
			Toast.makeText(MainActivity.this, b.getString("content"), Toast.LENGTH_SHORT).show();
        }
    };
```

Then, set up the notifications by providing your Handler:
```java
UINotifier notifier = new UINotifier(notificationHandler);
```

Of course, you need to configure in parallel the triggering of these notifications.
This can be done in your ***MainActivity*** by defining the following callbacks: ***EventsCallback***, ***StreamsCallback***, ***GetEventsCallback*** and ***GetStreamsCallback***
and in ***UINotifier*** by defining the ***notify*** function.

Here is an example of callback definition that will trigger the Handler we configured previously to inform the user about the result of an Event creation:

```java
private EventsCallback eventsCallback = new EventsCallback() {
	@Override
	public void onApiSuccess(String s, Event event, String s1, Double aDouble) {
		notifier.notify(s);
		Log.i("Pryv", s);
	}

	@Override
	public void onApiError(String s, Double aDouble) {
		notifier.notify(s);
		Log.e("Pryv", s);
	}

	@Override
	public void onCacheSuccess(String s, Event event) {
		notifier.notify(s);
		Log.i("Pryv", s);
	}

	@Override
	public void onCacheError(String s) {
		notifier.notify(s);
		Log.e("Pryv", s);
	}
};

public void notify(String notification) {
        if(notificationHandler!=null) {
            Bundle b = new Bundle();
            b.putString("content", notification);
            Message msg = new Message();
            msg.setData(b);
            notificationHandler.sendMessage(msg);
        }
    }
```

### Further explanations

If you still have misunderstandings when integrating Pryv into your app or if you want to see more concrete examples, do not hesitate to take a look at the sample [MainActivity](https://github.com/pryv/app-android-example/blob/master/app/src/main/java/com/pryv/appAndroidExample/MainActivity.java).
